<!DOCTYPE html>
<html>
<head>
    <link rel="shortcut icon" type="image/x-icon" href="/internal/gui/ico.png">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
    <meta http-equiv="Pragma" content="no-cache" />
    <meta http-equiv="Expires" content="0" />
    <style>
        .show {display: block;}

        table.blueTable {
            font-family: 'Courier New', Courier, monospace;
            border: 1px solid #1C6EA4;
            background-color: #EEEEEE;
            width: 100%;
            text-align: left;
            border-collapse: collapse;
        }
        table.blueTable td, table.blueTable th {
            border: 1px solid #AAAAAA;
            padding: 3px 2px;
        }
        table.blueTable tbody td {
            font-size: 13px;
        }
        table.blueTable tr:nth-child(even) {
            background: #D0E4F5;
        }
        table.blueTable thead {
            background: #1C6EA4;
            background: -moz-linear-gradient(top, #5592bb 0%, #327cad 66%, #1C6EA4 100%);
            background: -webkit-linear-gradient(top, #5592bb 0%, #327cad 66%, #1C6EA4 100%);
            background: linear-gradient(to bottom, #5592bb 0%, #327cad 66%, #1C6EA4 100%);
            border-bottom: 2px solid #444444;
        }
        table.blueTable thead th {
            font-size: 15px;
            font-weight: bold;
            color: #FFFFFF;
            border-left: 2px solid #D0E4F5;
        }
        table.blueTable thead th:first-child {
            border-left: none;
        }

        table.blueTable tfoot {
            font-size: 14px;
            font-weight: bold;
            color: #FFFFFF;
            background: #D0E4F5;
            background: -moz-linear-gradient(top, #dcebf7 0%, #d4e6f6 66%, #D0E4F5 100%);
            background: -webkit-linear-gradient(top, #dcebf7 0%, #d4e6f6 66%, #D0E4F5 100%);
            background: linear-gradient(to bottom, #dcebf7 0%, #d4e6f6 66%, #D0E4F5 100%);
            border-top: 2px solid #444444;
        }
        table.blueTable tfoot td {
            font-size: 14px;
        }
        table.blueTable tfoot a{
            display: inline-block;
            background: #1C6EA4;
            color: #FFFFFF;
            padding: 2px 8px;
            border-radius: 5px;
        }
        table.blueTable tfoot span{
            display: inline-block;
            color: #000000;
            padding: 2px 8px;
            border-radius: 5px;
        }

        th#idColumn {
            width: 18ch;
        }

        th#aktoridColumn {
            width: 20ch;
        }

        #authorization-message {
            color: red;
            font-weight: bold;
        }
    </style>
</head>
<body>

<h2>Henvendelse table examine</h2>

<div id="authorization-container">
    <label for="token">Authorization Token:</label>
    <input type="text" id="token" placeholder="Enter Bearer Token">
    <button onclick="authorize()">Authorize</button>
</div>
<br/>

<div id="authorization-message"></div>

<div id="table-container">
    <!-- Records will be loaded here dynamically -->
</div>

<script>
    let currentPage = 1;
    let pageSize = 1;
    let count = 0;
    let pageCount = 1;
    let authToken = '';

    window.onload = function() {
        console.log("Do on load");
        loadTablePage(currentPage);
    };

    const loadTablePage = async (page) => {
        const response = await fetch('/internal/view?page=' + page, {
            method: 'GET',
            headers: {
                'Content-Type': 'application/json',
                'Authorization': `Bearer ${authToken}`
            }
        });

        if (response.status === 401) {
            // Unauthorized
            document.getElementById('authorization-message').textContent = 'Unauthorized. Please enter a valid Authorization Token.';
            return;
        }

        const data = await response.json();
        const records = data.records;
        currentPage = data.page
        pageCount = data.pageCount
        pageSize = data.pageSize
        count = data.count
        // Display records in a table
        const tableContainer = document.getElementById('table-container');

        tableContainer.innerHTML = '<table class="blueTable">' +
            '<thead><tr><th id="idColumn">ID</th><th id="aktoridColumn">Aktor ID</th><th>JSON</th><th>Last Modified</th><th>Last Modified By SF</th></tr></thead><tbody>' +
            records.map(record =>
                `<tr>
                    <td>${record.id}</td>
                    <td>${record.aktorid}</td>
                    <td>${record.json}</td>
                    <td>${record.lastModified}</td>
                    <td>${record.lastModifiedBySF}</td>
                </tr>`
            ).join('') +
            '</tbody>' +
            '<tfoot>' +
            '<tr><td colspan="5"><span id="sampletext"></span></td></tr>' +
            '<tr><td colspan="5"><div class="links"><a href="#" onclick="loadPreviousPage()">&laquo;</a>' +
            '<span id="currentPage"></span><a href="#" <button onclick="loadNextPage()">Next</button>>&raquo;</a></div></td>' +
            '</tr>' +
            '</tfoot>'
            '</table>';

        // Update current page information
        const currentPageElement = document.getElementById('currentPage');
        const sampleTextElement = document.getElementById('sampletext');
        currentPageElement.textContent = `Page ${currentPage} of ${pageCount}`;
        sampleTextElement.textContent = `Showing ${pageSize} of ${count} records)`;
    };

    const loadPreviousPage = () => {
        if (currentPage > 1) {
            loadTablePage(currentPage - 1);
        }
    };

    const loadNextPage = () => {
        // You should check if there are more pages before loading the next one
        if (currentPage < pageCount) {
            loadTablePage(currentPage + 1);
        }
    };

    const authorize = () => {
        authToken = document.getElementById('token').value;
        // You may want to add some validation for the token before using it
        console.log(`Authorization token set: ${authToken}`);
        // Now, you can use authToken in the Authorization header for subsequent calls
        loadTablePage(currentPage);
    };
</script>

</body>
</html>